<!-- SIDEBAR -->
<div id="sidebar" class="relative xl:sticky xl:top-32 w-full xl:max-w-sm ~pt-8/10 p-4 border shadow-md rounded-4xl" data-category="{{ category }}">
    {% set sidebarItem = sidebar[category] %}

    <!-- BADGE -->
    <div class="absolute top-0 -translate-y-1/2 left-4 py-1.5 ~px-5/6 bg-category rounded-full" data-category="{{ category }}">
        <span class="~text-lg/xl font-semibold">{{ sidebarItem.name }}</span>
    </div>

    <!-- NAVIGATION -->
    <nav>
        <ul class="flex flex-col gap-0.5">
            {% for item in sidebarItem.items %}
                <li class="group/li relative flex flex-col">
                    <a href="{{ item.url }}" class="flex w-full py-1 px-4 text-gray-800 dark:text-gray-200 hover:text-black dark:hover:text-white rounded-full" data-category="{{ category }}"
                    {%- if page.url.startsWith(item.url) -%} aria-current="page" {%- endif -%}>
                        {{ item.text }}
                    </a>

                    {# Subitems have their own <ul> list #}
                    {% if item.subitems %}
                        {# Check if any of the subitems page is open #}
                        {% set open = page
                            .url
                            .startsWith(item.url) %}

                        {% if item.subitems %}
                            {% for subitem in item.subitems %}
                                {% if page
                                    .url
                                    .startsWith(subitem.url) %}
                                    {% set open = true %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}

                        <details class="group/details" {%- if open %} open {%- endif %}>
                            <summary class="absolute top-0.5 right-3 p-1 list-none hover:cursor-pointer" aria-controls="{{ item.text | slug }}-submenu">
                                <svg class="max-xl:hidden text-gray-800 dark:text-gray-200 transition-transform duration-300 group-open/details:rotate-90" xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 -960 960 960" fill="currentColor">
                                    <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/>
                                </svg>
                            </summary>

                            <ul id="{{ item.text | slug }}-submenu" class="hidden xl:flex flex-col gap-0.5 py-2 pl-4 pr-2">
                                {% for subitem in item.subitems %}
                                    <li class="flex">
                                        <a href="{{ subitem.url }}" class="w-full py-0.5 px-4 text-sm text-gray-800 dark:text-gray-200 hover:text-black dark:hover:text-white rounded-full" data-category="{{ category }}"
                                        {%- if page.url.startsWith(subitem.url) -%} aria-current="page" {%- endif -%}>
                                            {{ subitem.text }}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </details>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </nav>
</div>

{% set item = sidebar.spolecne.items | findWhere({"text": landing.heading}) %}
{% if item and item.subitems %}
    <!-- MOBILE SUBNAVIGATION -->
    <div class="xl:hidden flex flex-col ~gap-2/4 w-full">
        <!-- TOPPER + HEADING -->
        <div class="flex flex-col ~gap-0.5/gap-1.5">
            <span class="topper text-category" data-category="{{ category }}">{{ landing.heading }}</span>
            <h2 class="~text-2xl/4xl text-gray-950 dark:text-white font-extrabold">Rozcestník sekcí</h2>
        </div>

        <ul id="subnavigation" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 p-4 bg-spolecne-100 dark:bg-spolecne-950 border border-spolecne-200 dark:border-spolecne-800 shadow-md rounded-4xl">
            {% for subitem in item.subitems %}
                <li>
                    <a href="{{ subitem.url }}" class="flex justify-center py-2 px-4 bg-spolecne-200 dark:bg-spolecne-800 text-gray-800 dark:text-gray-200 rounded-2xl" data-category="{{ subitem.text | slug }}"
                    {%- if page.url.startsWith(subitem.url) -%} aria-current="page" {%- endif -%}>
                        {{ subitem.text }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endif %}